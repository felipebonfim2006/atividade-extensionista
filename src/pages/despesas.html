<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Despesas - Sua Carteira</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>

<header>
    <a href="../../index.html">Sua Carteira</a>
</header>

<main>
    <h1>Adicionar e acompanhar despesas</h1>

    <!-- ================= FIXAS ================= -->
    <h2>Despesas Fixas</h2>
    <button onclick="addFixa()">➕ Adicionar despesa fixa</button>

    <table>
        <thead>
            <tr>
                <th>Data</th>
                <th>Descrição</th>
                <th>Categoria</th>
                <th>Valor (R$)</th>
                <th>Ação</th>
            </tr>
        </thead>
        <tbody id="fixas"></tbody>
    </table>

    <h3>Total Fixas: R$ <span id="totalFixas">0,00</span></h3>

    <h3>Total por Categoria</h3>
    <ul id="totaisCategoria"></ul>

    <hr><br>

    <!-- ================= VARIÁVEIS ================= -->
    <h2>Despesas Variáveis</h2>
    <button onclick="addVariavel()">➕ Adicionar despesa variável</button>

    <table>
        <thead>
            <tr>
                <th>Data</th>
                <th>Descrição</th>
                <th>Categoria</th>
                <th>Valor (R$)</th>
                <th>Ação</th>
            </tr>
        </thead>
        <tbody id="variaveis"></tbody>
    </table>

    <h3>Total Variáveis: R$ <span id="totalVariaveis">0,00</span></h3>
</main>

<footer>
    <p>&copy; 2026 Sua Carteira</p>
</footer>

<script>
const categorias = [
    "Alimentação",
    "Aluguel",
    "Energia",
    "Internet",
    "Lazer",
    "Outros"
];

function formatarMoeda(input) {
    let v = input.value.replace(/\D/g, "");
    if (!v) {
        input.value = "";
        return;
    }
    v = (parseInt(v) / 100).toFixed(2);
    v = v.replace(".", ",");
    v = v.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    input.value = v;
}

function addFixa() {
    const tr = document.createElement("tr");
    tr.innerHTML = `
        <td><input type="date"></td>
        <td><input type="text" placeholder="Ex: Aluguel"></td>
        <td>
            <select>
                <option value="">Selecione</option>
                ${categorias.map(c => `<option>${c}</option>`).join("")}
            </select>
        </td>
        <td><input type="text" oninput="formatarMoeda(this); calcular()"></td>
        <td><button onclick="this.closest('tr').remove(); calcular()">❌</button></td>
    `;
    document.getElementById("fixas").appendChild(tr);
}

function addVariavel() {
    const tr = document.createElement("tr");
    tr.innerHTML = `
        <td><input type="date"></td>
        <td><input type="text" placeholder="Ex: Lanche"></td>
        <td><input type="text" placeholder="Categoria"></td>
        <td><input type="text" oninput="formatarMoeda(this); calcular()"></td>
        <td><button onclick="this.closest('tr').remove(); calcular()">❌</button></td>
    `;
    document.getElementById("variaveis").appendChild(tr);
}

function calcular() {
    let totalFixas = 0;
    let totalVariaveis = 0;
    let categoriasTotal = {};

    document.querySelectorAll("#fixas tr").forEach(tr => {
        let valor = tr.children[3].querySelector("input").value
            .replace(/\./g, "")
            .replace(",", ".");
        valor = parseFloat(valor);
        if (!isNaN(valor)) {
            totalFixas += valor;
            let cat = tr.children[2].querySelector("select").value;
            if (cat) {
                categoriasTotal[cat] = (categoriasTotal[cat] || 0) + valor;
            }
        }
    });

    document.querySelectorAll("#variaveis tr").forEach(tr => {
        let valor = tr.children[3].querySelector("input").value
            .replace(/\./g, "")
            .replace(",", ".");
        valor = parseFloat(valor);
        if (!isNaN(valor)) totalVariaveis += valor;
    });

    document.getElementById("totalFixas").innerText =
        totalFixas.toLocaleString("pt-BR", { minimumFractionDigits: 2 });

    document.getElementById("totalVariaveis").innerText =
        totalVariaveis.toLocaleString("pt-BR", { minimumFractionDigits: 2 });

    const ul = document.getElementById("totaisCategoria");
    ul.innerHTML = "";
    for (let c in categoriasTotal) {
        const li = document.createElement("li");
        li.innerText = `${c}: R$ ${categoriasTotal[c].toLocaleString("pt-BR", { minimumFractionDigits: 2 })}`;
        ul.appendChild(li);
    }
}
</script>

</body>
</html>
